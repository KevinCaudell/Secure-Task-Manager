const Database = require("better-sqlite3");

const db = new Database("app.db");

db.prepare(`
CREATE TABLE IF NOT EXISTS USER (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    EMAIL VARCHAR(60) UNIQUE NOT NULL,
    PASSWORD_HASH VARCHAR(255) NOT NULL,
    USERNAME VARCHAR(25) NOT NULL,
    CREATED_AT DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    LAST_LOGIN DATETIME
)
`).run();

db.prepare(`
CREATE TABLE IF NOT EXISTS CATEGORY (
    ID CHAR(3) PRIMARY KEY,
    NAME VARCHAR(25) NOT NULL,
    COLOR VARCHAR(15) NOT NULL
)
`).run()

db.prepare(`
CREATE TABLE IF NOT EXISTS TASK (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    TITLE VARCHAR(100) NOT NULL,
    DESCRIPTION TEXT,
    DUE_DATE DATE,
    PRIORITY CHAR(1),
    STATUS CHAR(1) NOT NULL,
    CREATED_AT DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT DATETIME,
    USER_ID INT NOT NULL,
    CATEGORY_ID CHAR(3) NOT NULL,
    FOREIGN KEY(USER_ID) REFERENCES USER(ID),
    FOREIGN KEY(CATEGORY_ID) REFERENCES CATEGORY(ID)
)
`).run();


module.exports = db;
